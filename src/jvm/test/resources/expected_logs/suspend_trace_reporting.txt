= Invalid execution results =
Parallel part:
| bar(): -1 | foo(): SUSPENDED + void |

= The following interleaving leads to the error =
Parallel part trace:
| bar()                                                                                                 |                                                                                                        |
|   barStarted.WRITE(true) at SuspendTraceReportingTest.bar(SuspendTraceReportingTest.kt:36)            |                                                                                                        |
|   lock(null): Unit@1 at SuspendTraceReportingTest.bar(SuspendTraceReportingTest.kt:68)                |                                                                                                        |
|     tryLock(null): true at MutexImpl.lock(Mutex.kt:184)                                               |                                                                                                        |
|     switch                                                                                            |                                                                                                        |
|                                                                                                       | foo()                                                                                                  |
|                                                                                                       |   barStarted.READ: true at SuspendTraceReportingTest.foo(SuspendTraceReportingTest.kt:27)              |
|                                                                                                       |   canEnterForbiddenBlock.WRITE(true) at SuspendTraceReportingTest.foo(SuspendTraceReportingTest.kt:27) |
|                                                                                                       |   lock(null): CoroutineSingletons@1 at SuspendTraceReportingTest.foo(SuspendTraceReportingTest.kt:58)  |
|                                                                                                       |     tryLock(null): false at MutexImpl.lock(Mutex.kt:184)                                               |
|                                                                                                       |     lockSuspend(null): CoroutineSingletons@1 at MutexImpl.lock(Mutex.kt:186)                           |
|                                                                                                       |       _state.READ: Empty@1 at MutexImpl.lockSuspend(Mutex.kt:434)                                      |
|                                                                                                       |       locked.READ: <LOCKED> at MutexImpl.lockSuspend(Mutex.kt:194)                                     |
|                                                                                                       |       locked.READ: <LOCKED> at MutexImpl.lockSuspend(Mutex.kt:195)                                     |
|                                                                                                       |       _state.compareAndSet(Empty@1,LockedQueue@1): true at MutexImpl.lockSuspend(Mutex.kt:195)         |
|                                                                                                       |       _state.READ: LockedQueue@1 at MutexImpl.lockSuspend(Mutex.kt:434)                                |
|                                                                                                       |       owner.READ: <LOCKED> at MutexImpl.lockSuspend(Mutex.kt:207)                                      |
|                                                                                                       |       _state.READ: LockedQueue@1 at MutexImpl.lockSuspend(Mutex.kt:219)                                |
|                                                                                                       |   switch (reason: coroutine is suspended)                                                              |
|                                                                                                       |   result: SUSPENDED + void                                                                             |
|     INSTANCE.READ: Unit@1 at MutexImpl.lock(Mutex.kt:184)                                             |                                                                                                        |
|   counter.READ: 0 at SuspendTraceReportingTest.bar(SuspendTraceReportingTest.kt:38)                   |                                                                                                        |
|   counter.WRITE(1) at SuspendTraceReportingTest.bar(SuspendTraceReportingTest.kt:38)                  |                                                                                                        |
|   unlock(null) at SuspendTraceReportingTest.bar(SuspendTraceReportingTest.kt:72)                      |                                                                                                        |
|   canEnterForbiddenBlock.READ: true at SuspendTraceReportingTest.bar(SuspendTraceReportingTest.kt:40) |                                                                                                        |
|   result: -1                                                                                          |                                                                                                        |
|   thread is finished                                                                                  |                                                                                                        |
|                                                                                                       |   thread is finished                                                                                   |

Detailed parallel part trace:
| bar()                                                                                                 |                                                                                                        |
|   barStarted.WRITE(true) at SuspendTraceReportingTest.bar(SuspendTraceReportingTest.kt:36)            |                                                                                                        |
|   lock(null): Unit@1 at SuspendTraceReportingTest.bar(SuspendTraceReportingTest.kt:68)                |                                                                                                        |
|     tryLock(null): true at MutexImpl.lock(Mutex.kt:184)                                               |                                                                                                        |
|       _state.READ: Empty@2 at MutexImpl.tryLock(Mutex.kt:428)                                         |                                                                                                        |
|       locked.READ: <UNLOCKED> at MutexImpl.tryLock(Mutex.kt:166)                                      |                                                                                                        |
|       _state.compareAndSet(Empty@2,Empty@1): true at MutexImpl.tryLock(Mutex.kt:170)                  |                                                                                                        |
|     switch                                                                                            |                                                                                                        |
|                                                                                                       | foo()                                                                                                  |
|                                                                                                       |   barStarted.READ: true at SuspendTraceReportingTest.foo(SuspendTraceReportingTest.kt:27)              |
|                                                                                                       |   canEnterForbiddenBlock.WRITE(true) at SuspendTraceReportingTest.foo(SuspendTraceReportingTest.kt:27) |
|                                                                                                       |   lock(null): CoroutineSingletons@1 at SuspendTraceReportingTest.foo(SuspendTraceReportingTest.kt:58)  |
|                                                                                                       |     tryLock(null): false at MutexImpl.lock(Mutex.kt:184)                                               |
|                                                                                                       |       _state.READ: Empty@1 at MutexImpl.tryLock(Mutex.kt:428)                                          |
|                                                                                                       |       locked.READ: <LOCKED> at MutexImpl.tryLock(Mutex.kt:166)                                         |
|                                                                                                       |     lockSuspend(null): CoroutineSingletons@1 at MutexImpl.lock(Mutex.kt:186)                           |
|                                                                                                       |       _state.READ: Empty@1 at MutexImpl.lockSuspend(Mutex.kt:434)                                      |
|                                                                                                       |       locked.READ: <LOCKED> at MutexImpl.lockSuspend(Mutex.kt:194)                                     |
|                                                                                                       |       locked.READ: <LOCKED> at MutexImpl.lockSuspend(Mutex.kt:195)                                     |
|                                                                                                       |       _state.compareAndSet(Empty@1,LockedQueue@1): true at MutexImpl.lockSuspend(Mutex.kt:195)         |
|                                                                                                       |       _state.READ: LockedQueue@1 at MutexImpl.lockSuspend(Mutex.kt:434)                                |
|                                                                                                       |       owner.READ: <LOCKED> at MutexImpl.lockSuspend(Mutex.kt:207)                                      |
|                                                                                                       |       _state.READ: LockedQueue@1 at MutexImpl.lockSuspend(Mutex.kt:219)                                |
|                                                                                                       |   switch (reason: coroutine is suspended)                                                              |
|                                                                                                       |   result: SUSPENDED + void                                                                             |
|     INSTANCE.READ: Unit@1 at MutexImpl.lock(Mutex.kt:184)                                             |                                                                                                        |
|   counter.READ: 0 at SuspendTraceReportingTest.bar(SuspendTraceReportingTest.kt:38)                   |                                                                                                        |
|   counter.WRITE(1) at SuspendTraceReportingTest.bar(SuspendTraceReportingTest.kt:38)                  |                                                                                                        |
|   unlock(null) at SuspendTraceReportingTest.bar(SuspendTraceReportingTest.kt:72)                      |                                                                                                        |
|     _state.READ: LockedQueue@1 at MutexImpl.unlock(Mutex.kt:438)                                      |                                                                                                        |
|     tryResumeLockWaiter(): true at MutexImpl.unlock(Mutex.kt:340)                                     |                                                                                                        |
|       take(): true at MutexImpl$LockCont.tryResumeLockWaiter(Mutex.kt:385)                            |                                                                                                        |
|         isTaken.compareAndSet(0,1): true at MutexImpl$LockWaiter.take(Mutex.kt:373)                   |                                                                                                        |
|       INSTANCE.READ: Unit@1 at MutexImpl$LockCont.tryResumeLockWaiter(Mutex.kt:386)                   |                                                                                                        |
|     owner.READ: null at MutexImpl.unlock(Mutex.kt:341)                                                |                                                                                                        |
|     owner.WRITE(<LOCKED>) at MutexImpl.unlock(Mutex.kt:341)                                           |                                                                                                        |
|     completeResumeLockWaiter() at MutexImpl.unlock(Mutex.kt:342)                                      |                                                                                                        |
|       RESUME_TOKEN.READ: <RESUME_TOKEN> at MutexImpl$LockCont.completeResumeLockWaiter(Mutex.kt:392)  |                                                                                                        |
|       completeResume(<RESUME_TOKEN>) at MutexImpl$LockCont.completeResumeLockWaiter(Mutex.kt:392)     |                                                                                                        |
|         size.READ: 2 at ArrayList.get(ArrayList.java:426)                                             |                                                                                                        |
|         elementData(1): AtomicReferenceArray@1 at ArrayList.get(ArrayList.java:427)                   |                                                                                                        |
|           elementData.READ: Object[]@1 at ArrayList.elementData(ArrayList.java:410)                   |                                                                                                        |
|           Array[1].READ: AtomicReferenceArray@1 at ArrayList.elementData(ArrayList.java:410)          |                                                                                                        |
|   canEnterForbiddenBlock.READ: true at SuspendTraceReportingTest.bar(SuspendTraceReportingTest.kt:40) |                                                                                                        |
|   result: -1                                                                                          |                                                                                                        |
|   thread is finished                                                                                  |                                                                                                        |
|                                                                                                       |   thread is finished                                                                                   |